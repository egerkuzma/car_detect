# Детектор и счетчик транспортных средств

Скрипт для детекции и подсчета транспортных средств в видеопотоке с использованием YOLO и OpenCV.

![Пример работы детектора](images/res.mp4)

## Возможности

- Детекция транспортных средств в реальном времени
- Подсчет транспортных средств, пересекающих заданную линию
- Поддержка RTSP-потоков
- Возможность выбора области интереса (ROI)
- Отображение полного кадра или только области интереса
- Сохранение результата в видеофайл
- Отображение FPS и количества обнаруженных транспортных средств
- Поддержка CUDA для ускорения обработки

## Требования

- Python 3.8+
- CUDA-совместимая видеокарта (опционально)
- Установленные зависимости из requirements.txt

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd car_detect
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Скачайте модель YOLO:
```bash
# Убедитесь, что файл yolo11s.pt находится в той же директории, что и скрипт
```

## Использование

### Базовый запуск

```bash
python car_detect.py --roi-x 100 --roi-y 100 --roi-width 300 --roi-height 200
```

### Параметры командной строки

- `--input`: URL RTSP-потока (по умолчанию: rtsp://rtsp:12345678@192.168.1.128:554/av_stream/ch0)
- `--output`: путь для сохранения видео (опционально)
- `--conf`: порог уверенности для детекции (0.0-1.0, по умолчанию: 0.1)
- `--roi-x`: X-координата области интереса (обязательный параметр)
- `--roi-y`: Y-координата области интереса (обязательный параметр)
- `--roi-width`: ширина области интереса (обязательный параметр)
- `--roi-height`: высота области интереса (обязательный параметр)
- `--zoom-factor`: коэффициент увеличения (по умолчанию: 2.0)
- `--speed`: множитель скорости воспроизведения (по умолчанию: 1.0)
- `--show-full-frame`: показывать полный кадр вместо только области интереса

### Примеры использования

1. Просмотр только области интереса:
```bash
python car_detect.py --roi-x 100 --roi-y 100 --roi-width 300 --roi-height 200
```

2. Просмотр полного кадра:
```bash
python car_detect.py --roi-x 100 --roi-y 100 --roi-width 300 --roi-height 200 --show-full-frame
```

3. Сохранение результата в файл:
```bash
python car_detect.py --roi-x 100 --roi-y 100 --roi-width 300 --roi-height 200 --output output.mp4
```

4. Настройка порога уверенности:
```bash
python car_detect.py --roi-x 100 --roi-y 100 --roi-width 300 --roi-height 200 --conf 0.3
```

## Управление

- Нажмите 'Q' для выхода из программы

## Примечания

- Для оптимальной производительности рекомендуется использовать CUDA-совместимую видеокарту
- При использовании RTSP-потока убедитесь, что URL и учетные данные корректны
- Размер области интереса (ROI) должен быть меньше размера входного кадра
- При сохранении видео убедитесь, что указанный путь доступен для записи

## Примеры работы

Ниже представлены примеры работы скрипта в различных режимах:

### Режим полного кадра

![Режим полного кадра](images/full_frame_example.jpg)

На изображении показан полный кадр с выделенной областью интереса (желтый прямоугольник) и обнаруженными транспортными средствами (зеленые прямоугольники).

### Режим области интереса (ROI)

![Режим области интереса](images/roi_example.jpg)

На изображении показана только область интереса с обнаруженными транспортными средствами.

## Лицензия

MIT 